<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meli+ Final Perfect Stack</title>
    <style>
        :root {
            --primary-blue: #3483FA;
            --primary-purple: #A90F90;
            --meli-green: #00A650;
            --bg-gray: #EFEFEF;
            --white: #FFFFFF;
            --card-radius: 24px;
            
            /* --- DIMENSÕES FIXAS --- */
            --header-height: 70px;     
            --tab-height: 50px;        /* Altura visual do botão tab */
            --tab-margin: 30px;        /* Espaço acima/abaixo da tab */
            
            /* Cálculo do espaço total ocupado pela área da tab no topo */
            --top-area-space: 90px;    /* Onde o primeiro card deve travar */
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Proxima Nova', -apple-system, sans-serif; }
        body {
            background-color: var(--bg-gray);
            min-height: 100vh;
            overflow-x: hidden;
        }
        /* Hero Section */
        .hero-section {
            height: 60vh;
            background: linear-gradient(135deg, #F5D415 0%, #F5D415 100%);
            display: flex; align-items: center; justify-content: center; flex-direction: column;
            color: #2D3277;
            text-align: center;
        }
        .hero-section h1 { font-size: 32px; margin-bottom: 10px; }
        /* --- SECTION PRINCIPAL --- */
        .pricing-section {
            position: relative;
            padding-bottom: 100vh; 
            padding-top: 20px;
        }
        /* --- CONTROLES (TAB) --- */
        .controls-container {
            position: sticky;
            top: 20px; /* Margem do topo da tela */
            z-index: 0; /* Abaixo de todos os cards */
            
            /* REMOVIDO: Background e Box-shadow */
            background: transparent; 
            box-shadow: none;
            
            display: flex; 
            justify-content: center;
            height: var(--tab-height);
            margin-bottom: var(--tab-margin);
            
            /* Permite clicar através da área transparente, mas não nos botões */
            pointer-events: none; 
        }
        .pricing-toggle {
            display: flex; 
            background: #e0e0e0; /* Cinza levemente mais escuro para contraste */
            padding: 4px; 
            border-radius: 30px;
            pointer-events: auto; /* Reabilita cliques nos botões */
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); /* Sombra sutil apenas na pílula */
        }
        .toggle-btn {
            padding: 8px 24px; 
            border: none; 
            background: transparent;
            border-radius: 25px; 
            font-weight: 600; 
            font-size: 14px;
            color: #666; 
            cursor: pointer; 
            transition: 0.3s;
            display: flex; align-items: center; gap: 5px;
        }
        .toggle-btn.active {
            background: var(--white); 
            /* CORRIGIDO: Texto preto no ativo */
            color: #000000; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .toggle-btn .discount-text {
            color: var(--meli-green); 
            /* CORRIGIDO: Peso normal e fonte menor */
            font-weight: 400; 
            font-size: 11px; 
        }
        .stack-container {
            padding: 0 16px; max-width: 500px; margin: 0 auto;
        }
        /* --- CARDS --- */
        .card {
            position: sticky; 
            background: var(--white);
            border-radius: var(--card-radius);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 16px; 
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.08);
            display: flex; flex-direction: column;
            /* Altura automática */
            height: auto; 
            
            /* Garante que o conteúdo não vaze */
            z-index: 1; 
        }
        
        /* O último card não precisa de margem inferior, pois é o fim da stack */
        .card:last-child { margin-bottom: 0; }
        
        /* --- LÓGICA DE EMPILHAMENTO (TOP OFFSETS) --- */
        
        /* Card 1: Trava logo abaixo da área da tab - FICA POR BAIXO */
        .card-1 { 
            top: var(--top-area-space); 
            z-index: 1; 
        }
        
        /* Card 2: Trava abaixo do Card 1 - FICA NO MEIO, POR CIMA DO CARD 1 */
        .card-2 { 
            top: calc(var(--top-area-space) + var(--header-height)); 
            z-index: 2; 
        }
        
        /* Card 3: Trava abaixo do Card 2 - FICA POR CIMA DE TODOS */
        .card-3 { 
            top: calc(var(--top-area-space) + var(--header-height) + var(--header-height)); 
            z-index: 3; 
            border: 1px solid var(--primary-purple); 
        }
        
        /* Card 4: Espaçador invisível para garantir scroll */
        .card-4 { 
            top: calc(var(--top-area-space) + var(--header-height) * 3); 
            z-index: 4; 
            opacity: 0;
            pointer-events: none;
        }
        
        /* Styles Internos */
        .card-header {
            height: var(--header-height); padding: 0 20px;
            display: flex; align-items: center; justify-content: space-between;
            background: #fafafa; border-bottom: 1px solid #eee;
            cursor: pointer; transition: background 0.3s; flex-shrink: 0;
        }
        
        /* Muda cor do header quando 'stuck' para indicar sobreposição (opcional, mas ajuda no visual) */
        .card.is-stuck .card-header { background-color: #f5f5f5; }
        .header-left { display: flex; align-items: center; gap: 8px; }
        .meli-logo { font-weight: 800; font-style: italic; color: var(--primary-purple); }
        .plan-name { font-weight: 700; color: #2D3277; text-transform: uppercase; font-size: 14px; }
        .header-right { text-align: right; }
        .mini-price { font-size: 16px; font-weight: 700; color: #333; opacity: 0; transform: translateX(10px); transition: all 0.3s ease; }
        
        /* Preço aparece no header quando stuck (Exceto no Mega) */
        .card:not(#card-mega).is-stuck .mini-price { opacity: 1; transform: translateX(0); }
        
        .header-special-tag { color: var(--meli-green); font-weight: 700; font-size: 12px; text-transform: uppercase; display: block; }
        .card-body { padding: 24px; background: var(--white); display: flex; flex-direction: column; }
        .desc { color: #666; line-height: 1.5; font-size: 15px; margin-bottom: 0; }
        .main-price { font-size: 42px; font-weight: 600; color: #333; margin-bottom: 8px; line-height: 1; }
        .main-price span { font-size: 16px; font-weight: 400; color: #666; margin-left: 4px; }
        
        .mega-body-pricing { margin-bottom: 8px; }
        .mb-row-1 { display: flex; align-items: center; gap: 10px; margin-bottom: 4px; }
        .mb-old { text-decoration: line-through; color: #999; font-size: 16px; }
        .mb-off { color: var(--meli-green); font-weight: 700; font-size: 16px; }
        .mb-row-2 { font-size: 42px; font-weight: 600; color: #333; line-height: 1; }
        .mb-period { font-size: 16px; font-weight: 400; color: #666; margin-left: 4px; }
        .actions-row { display: flex; align-items: center; gap: 12px; margin-top: 24px; }
        .btn-subscribe { flex: 1; background-color: var(--primary-blue); color: white; border: none; padding: 16px; border-radius: 12px; font-weight: 600; font-size: 16px; cursor: pointer; transition: background 0.2s; }
        .btn-subscribe:hover { background-color: #2968c8; }
        .btn-details-icon { flex: 0 0 54px; height: 54px; border: 2px solid var(--primary-blue); border-radius: 12px; background: transparent; color: var(--primary-blue); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: background 0.2s; }
        .btn-details-icon:hover { background-color: rgba(52, 131, 250, 0.08); }
        .btn-details-icon svg { width: 24px; height: 24px; fill: currentColor; }
        /* Modais */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s ease; backdrop-filter: blur(2px); }
        .modal-overlay.open { display: flex; opacity: 1; }
        .modal-content { background: white; width: 90%; max-width: 450px; border-radius: 16px; display: flex; flex-direction: column; max-height: 85vh; position: relative; transform: translateY(20px); transition: transform 0.3s ease; box-shadow: 0 10px 30px rgba(0,0,0,0.2); overflow: hidden; }
        .modal-overlay.open .modal-content { transform: translateY(0); }
        .close-btn { position: absolute; top: 16px; right: 16px; background: none; border: none; font-size: 24px; color: #999; cursor: pointer; line-height: 1; z-index: 5; }
        .modal-header { padding: 24px 24px 10px 24px; text-align: center; flex-shrink: 0; }
        .modal-pill { background: #f5f5f5; display: inline-block; padding: 4px 12px; border-radius: 20px; margin-bottom: 10px; }
        .modal-pill strong { color: var(--primary-purple); font-weight: 800; font-style: italic; }
        .modal-pill span { color: #2D3277; font-weight: 700; text-transform: uppercase; font-size: 12px; }
        .modal-scroll-area { flex: 1; overflow-y: auto; padding: 0 24px; scrollbar-width: none; -ms-overflow-style: none; }
        .modal-scroll-area::-webkit-scrollbar { display: none; }
        .benefit-list { list-style: none; text-align: left; padding-bottom: 10px; }
        .benefit-item { display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; border-bottom: 1px solid #f0f0f0; font-size: 14px; color: #333; line-height: 1.4; }
        .modal-footer { padding: 16px 24px; background: white; border-top: 1px solid #eee; flex-shrink: 0; }
        .modal-btn-cta { width: 100%; background-color: var(--primary-blue); color: white; border: none; padding: 14px; border-radius: 10px; font-weight: 600; font-size: 16px; cursor: pointer; }
        .icon { min-width: 18px; font-weight: bold; }
        .icon.check { color: var(--meli-green); }
        .icon.cross { color: #ddd; }
        .item-text.disabled { color: #999; }
        
        .footer-section { height: 100vh; background: #2D3277; color: white; display: flex; align-items: center; justify-content: center; flex-direction: column; position: relative; z-index: 50; }
    </style>
</head>
<body>
    <section class="hero-section">
        <h1>Conheça o novo Meli+</h1>
        <p>↓ Role para ver os planos ↓</p>
    </section>
    <section class="pricing-section">
        
        <!-- Tab de Controles -->
        <div class="controls-container">
            <div class="pricing-toggle">
                <button class="toggle-btn active" onclick="setCycle('monthly')">Mensal</button>
                <button class="toggle-btn" onclick="setCycle('annual')">Anual <span class="discount-text">15% OFF</span></button>
            </div>
        </div>
        <div class="stack-container">
            <!-- Card 1 -->
            <div class="card card-1" id="card-essencial">
                <div class="card-header">
                    <div class="header-left">
                        <span class="meli-logo">meli+</span>
                        <span class="plan-name">Essencial</span>
                    </div>
                    <div class="header-right"><div class="mini-price val-essencial">R$ 9,90</div></div>
                </div>
                <div class="card-body">
                    <div class="main-price val-essencial">R$ 9,90<span>/mês</span></div>
                    <p class="desc">A porta de entrada. Frete Grátis em milhões de produtos.</p>
                    <div class="actions-row">
                        <button class="btn-details-icon" onclick="openModal('modal-essencial')"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg></button>
                        <button class="btn-subscribe">Assinar Essencial</button>
                    </div>
                </div>
            </div>
            <!-- Card 2 -->
            <div class="card card-2" id="card-total">
                <div class="card-header">
                    <div class="header-left">
                        <span class="meli-logo">meli+</span>
                        <span class="plan-name">Total</span>
                    </div>
                    <div class="header-right"><div class="mini-price val-total">R$ 24,90</div></div>
                </div>
                <div class="card-body">
                    <div class="main-price val-total">R$ 24,90<span>/mês</span></div>
                    <p class="desc">Inclui Disney+ Padrão com Anúncios e Deezer Premium.</p>
                    <div class="actions-row">
                        <button class="btn-details-icon" onclick="openModal('modal-total')"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg></button>
                        <button class="btn-subscribe">Assinar Total</button>
                    </div>
                </div>
            </div>
            <!-- Card 3 -->
            <div class="card card-3" id="card-mega">
                <div class="card-header">
                    <div class="header-left">
                        <span class="meli-logo">meli+</span>
                        <span class="plan-name">Mega</span>
                    </div>
                    <div class="header-right"><div class="header-special-tag">OFERTA ESPECIAL</div></div>
                </div>
                <div class="card-body">
                    <div class="mega-body-pricing">
                        <div class="mb-row-1">
                            <span class="mb-old val-mega-base">R$ 74,90</span>
                            <span class="mb-off">46% OFF</span>
                        </div>
                        <div class="mb-row-2">
                            <span class="val-mega-promo">R$ 39,90</span>
                            <span class="mb-period">/mês por 2 meses</span>
                        </div>
                    </div>
                    <p class="desc">A experiência definitiva. Disney+, Max, Netflix (Padrão) e mais.</p>
                    <div class="actions-row">
                        <button class="btn-details-icon" onclick="openModal('modal-mega')"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg></button>
                        <button class="btn-subscribe">Assinar Mega</button>
                    </div>
                </div>
            </div>
            
            <!-- Card 4: Espaçador invisível -->
            <div class="card card-4">
                <div class="card-header">
                    <div class="header-left">
                        <span class="meli-logo">meli+</span>
                        <span class="plan-name">Espaçador</span>
                    </div>
                </div>
                <div class="card-body">
                    <p class="desc">Este card garante que há scroll suficiente</p>
                </div>
            </div>
        </div>
    </section>
    <section class="footer-section">
        <h2>Próxima Seção</h2>
        <p>O conjunto todo subiu em bloco.</p>
    </section>
    <!-- Modais -->
    <div id="modal-essencial" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal(event, true)">×</button>
            <div class="modal-header">
                <div class="modal-pill"><strong>meli+</strong> <span>| ESSENCIAL</span></div>
                <div class="main-price val-essencial" style="font-size: 32px;">R$ 9,90<span>/mês</span></div>
            </div>
            <div class="modal-scroll-area">
                <ul class="benefit-list">
                    <li class="benefit-item"><span class="icon check">✓</span> Frete Grátis Rápido</li>
                    <li class="benefit-item"><span class="icon check">✓</span> Cashback ML</li>
                    <li class="benefit-item"><span class="icon check">✓</span> Conta rendendo 105% CDI</li>
                    <li class="benefit-item"><span class="icon check">✓</span> Caixinhas rendendo 120% CDI</li>
                    <li class="benefit-item"><span class="icon cross">✕</span> <span class="item-text disabled">Disney+</span></li>
                    <li class="benefit-item"><span class="icon cross">✕</span> <span class="item-text disabled">HBO Max</span></li>
                </ul>
            </div>
            <div class="modal-footer"><button class="modal-btn-cta">Assinar Essencial</button></div>
        </div>
    </div>
    <div id="modal-total" class="modal-overlay" onclick="closeModal(event)">
         <div class="modal-content">
            <button class="close-btn" onclick="closeModal(event, true)">×</button>
            <div class="modal-header">
                <div class="modal-pill"><strong>meli+</strong> <span>| TOTAL</span></div>
                <div class="main-price val-total" style="font-size: 32px;">R$ 24,90<span>/mês</span></div>
            </div>
            <div class="modal-scroll-area">
                <ul class="benefit-list">
                    <li class="benefit-item"><span class="icon check">✓</span> Frete Grátis Rápido</li>
                    <li class="benefit-item"><span class="icon check">✓</span> Cashback ML</li>
                    <li class="benefit-item"><span class="icon check">✓</span> Conta rendendo 105% CDI</li>
                    <li class="benefit-item"><span class="icon check">✓</span> Caixinhas rendendo 120% CDI</li>
                    <li class="benefit-item"><span class="icon check">✓</span> Disney+</li>
                    <li class="benefit-item"><span class="icon check">✓</span> HBO Max 70% OFF</li>
                </ul>
            </div>
            <div class="modal-footer"><button class="modal-btn-cta">Assinar Total</button></div>
        </div>
    </div>
    <div id="modal-mega" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal(event, true)">×</button>
            <div class="modal-header">
                <div class="modal-pill"><strong>meli+</strong> <span>| MEGA</span></div>
                <div class="main-price val-mega-promo" style="font-size: 32px;">R$ 39,90<span>/mês</span></div>
            </div>
            <div class="modal-scroll-area">
                <ul class="benefit-list">
                    <li class="benefit-item"><span class="icon check">✓</span> Frete Grátis Rápido</li>
                    <li class="benefit-item"><span class="icon check">✓</span> Cashback ML (até 3%)</li>
                    <li class="benefit-item"><span class="icon check">✓</span> Conta rendendo 105% CDI</li>
                    <li class="benefit-item"><span class="icon check">✓</span> Caixinhas rendendo 120% CDI</li>
                    <li class="benefit-item"><span class="icon check">✓</span> Disney+</li>
                    <li class="benefit-item"><span class="icon check">✓</span> HBO Max</li>
                </ul>
            </div>
            <div class="modal-footer"><button class="modal-btn-cta">Assinar Mega</button></div>
        </div>
    </div>
    <script>
        const prices = { monthly: { ess: 'R$ 9,90', tot: 'R$ 24,90', megaBase: 'R$ 74,90', megaPromo: 'R$ 39,90' }, annual: { ess: 'R$ 8,90', tot: 'R$ 22,90', megaBase: 'R$ 59,90', megaPromo: 'R$ 34,90' } };
        function setCycle(type) {
            document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
            const p = prices[type];
            updatePrice('.val-essencial', p.ess);
            updatePrice('.val-total', p.tot);
            document.querySelectorAll('.val-mega-base').forEach(el => el.textContent = p.megaBase);
            document.querySelectorAll('.val-mega-promo').forEach(el => el.textContent = p.megaPromo);
        }
        function updatePrice(selector, value) {
            document.querySelectorAll(selector).forEach(el => {
                if(el.classList.contains('main-price')) { el.innerHTML = value + '<span>/mês</span>'; } else { el.textContent = value; }
            });
        }
        
        // CORREÇÃO: Função melhorada para verificar o estado sticky
        function checkSticky() {
            const cards = document.querySelectorAll('.card');
            const controlsContainer = document.querySelector('.controls-container');
            
            cards.forEach(card => {
                const rect = card.getBoundingClientRect();
                const top = parseFloat(getComputedStyle(card).top);
                
                // Verifica se o card atingiu sua posição sticky
                if (rect.top <= top) {
                    card.classList.add('is-stuck');
                } else {
                    card.classList.remove('is-stuck');
                }
            });
        }
        
        window.addEventListener('scroll', checkSticky);
        window.addEventListener('resize', checkSticky);
        window.addEventListener('load', checkSticky);
        
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('open');
            document.body.style.overflow = 'hidden'; 
        }
        function closeModal(event, force) {
            if (force || event.target.classList.contains('modal-overlay')) {
                document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('open'));
                document.body.style.overflow = ''; 
                document.body.style.overflowX = 'hidden';
            }
        }
    </script>
</body>
</html>